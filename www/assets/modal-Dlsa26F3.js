import{g as l,a as h,b as u}from"./tabbable-D_Tgg1nc.js";let r=[];class f{constructor(e){this.tabDirection="forward",this.handleFocusIn=()=>{this.isActive()&&this.checkFocus()},this.handleKeyDown=i=>{if(i.key!=="Tab"||this.isExternalActivated||!this.isActive())return;const o=l();if(this.previousFocus=o,this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus))return;i.shiftKey?this.tabDirection="backward":this.tabDirection="forward";const t=h(this.element);let s=t.findIndex(n=>n===o);this.previousFocus=this.currentFocus;const c=this.tabDirection==="forward"?1:-1;for(;;){s+c>=t.length?s=0:s+c<0?s=t.length-1:s+=c,this.previousFocus=this.currentFocus;const n=t[s];if(this.tabDirection==="backward"&&this.previousFocus&&this.possiblyHasTabbableChildren(this.previousFocus)||n&&this.possiblyHasTabbableChildren(n))return;i.preventDefault(),this.currentFocus=n,this.currentFocus?.focus({preventScroll:!1});const a=[...u()];if(a.includes(this.currentFocus)||!a.includes(this.previousFocus))break}setTimeout(()=>this.checkFocus())},this.handleKeyUp=()=>{this.tabDirection="forward"},this.element=e,this.elementsWithTabbableControls=["iframe"]}activate(){r.push(this.element),document.addEventListener("focusin",this.handleFocusIn),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}deactivate(){r=r.filter(e=>e!==this.element),this.currentFocus=null,document.removeEventListener("focusin",this.handleFocusIn),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}isActive(){return r[r.length-1]===this.element}activateExternal(){this.isExternalActivated=!0}deactivateExternal(){this.isExternalActivated=!1}checkFocus(){if(this.isActive()&&!this.isExternalActivated){const e=h(this.element);if(!this.element.matches(":focus-within")){const i=e[0],o=e[e.length-1],t=this.tabDirection==="forward"?i:o;typeof t?.focus=="function"&&(this.currentFocus=t,t.focus({preventScroll:!1}))}}}possiblyHasTabbableChildren(e){return this.elementsWithTabbableControls.includes(e.tagName.toLowerCase())||e.hasAttribute("controls")}}export{f as M};
